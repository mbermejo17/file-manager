(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

////////////////////////////////////
// Users manage module
///////////////////////////////////

var searchUserName = function searchUserName(userName) {
  if (RunMode === "DEBUG") console.log(userName);

  execFetch("/searchuser?userName=" + userName, "GET", null).then(function (d) {
    if (RunMode === "DEBUG") console.log(d);
    if (d.status == "OK") {
      showAddUserForm("Edit User", d.data);
    } else {
      showToast(d.message, "err");
    }
  }).catch(function (e) {
    showToast("Error al buscar usuario " + userName + ".<br>Err:" + e, "err");
    if (RunMode === "DEBUG") console.log(e);
  });
};

var LoadUsersList = function LoadUsersList(el) {
  execFetch("/users", "GET").then(function (d) {
    if (RunMode === "DEBUG") console.log(d);
    var users = d.data;
    var options = '';
    for (var x = 0; x < users.length; x++) {
      options += "<option id=\"" + users[x].UserId + "\">" + users[x].UserName + "</option>";
    }
    el.innerHTML = options;
  }).catch(function (e) {
    showToast("Error al grabar los cambios para el usuario " + data.userName + ".<br>Err:" + e, "err");
    if (RunMode === "DEBUG") console.log(e);
  });
};

var editUser = function editUser() {
  var AddUserModalContent = document.querySelector("#AddUserModalContent");
  var SearchUserModalContent = document.querySelector("#searchUserModalContent");

  var containerOverlay = document.querySelector(".container-overlay");
  AddUserModalContent.style.display = "none";
  SearchUserModalContent.innerHTML = htmlSearchUserTemplate;
  LoadUsersList(document.getElementById('usersList'));
  SearchUserModalContent.style.display = "block";
  containerOverlay.style.display = "block";
  SearchUserModalContent.addEventListener("keyup", function (e) {
    e.preventDefault();
    if (e.keyCode === 13) {
      searchUserName(document.getElementById("searchUserName").value);
    }
  });
  document.querySelector("#btnSearchUser").addEventListener("click", function (e) {
    e.preventDefault();
    searchUserName(document.getElementById("searchUserName").value);
  });
  document.querySelector("#btn-SearchUserCancel").addEventListener("click", function (e) {
    e.preventDefault();
    SearchUserModalContent.style.display = "none";
    containerOverlay.style.display = "none";
  });
};

var selectRole = function selectRole(element, role) {
  if (RunMode === "DEBUG") console.log(role);
  for (var x = 0; x < element.options.length; x++) {
    if (RunMode === "DEBUG") console.log("option: ", element.options[x].text);
    if (element.options[x].text.toUpperCase() === role.toUpperCase()) {
      element.options[x].selected = "selected";
      element.selectedIndex = x;
      if (RunMode === "DEBUG") console.log("option selected: ", element.options[x].text);
      if (role.toUpperCase() !== "CUSTOM") {
        changeAccessRights(document.querySelectorAll(".AccessRightsSwitch"), element.options[x].value);
      }
      break;
    }
  }
};

var showAddUserForm = function showAddUserForm(title, data) {
  var AddUserModalContent = document.querySelector("#AddUserModalContent");
  var containerOverlay = document.querySelector(".container-overlay");
  var SearchUserModalContent = document.querySelector("#searchUserModalContent");
  var mode = data ? "edit" : "add";
  var oldData = null;
  SearchUserModalContent.style.display = "none";

  AddUserModalContent.innerHTML = htmlUserFormTemplate;
  if (data) {
    if (RunMode === "DEBUG") console.log(data);
    oldData = _extends({}, data);
    document.querySelector("#userFormTitle").innerHTML = title;
    document.querySelector("#UserName").value = data.UserName;
    document.querySelector("#CompanyName").value = data.CompanyName;
    document.querySelector("#UserPasswd").value = data.UserPasswd;
    document.querySelector("#repeatUserPasswd").value = data.UserPasswd;
    document.querySelector("#RootPath").value = data.RootPath;
    document.querySelector("#ExpirateDate").value = data.ExpirateDate;
    //document.querySelector("#expirationDate")
    selectRole(document.querySelector("#RoleOptions"), data.Role);
    if (data.Role.toUpperCase() === "CUSTOM") checkAccessRights(data.AccessString);
    containerOverlay.style.display = "block";
    AddUserModalContent.style.display = "block";
    document.querySelector("label[for=UserName]").classList.add("active");
    document.querySelector("label[for=CompanyName]").classList.add("active");
    document.querySelector("label[for=UserPasswd]").classList.add("active");
    document.querySelector("label[for=repeatUserPasswd]").classList.add("active");
    document.querySelector("label[for=RootPath]").classList.add("active");
    document.querySelector("#UserName").disabled = true;

    document.querySelector("#btn-addUserCancel").addEventListener("click", function (e) {
      e.preventDefault();
      //containerOverlay.style.display = "none";
      AddUserModalContent.style.display = "none";
      SearchUserModalContent.style.display = "block";
    });
    document.querySelector("#btn-addUserAcept").addEventListener("click", function (e) {
      e.preventDefault();
      _updateUser(oldData);
    });
  } else {
    containerOverlay.style.display = "block";
    AddUserModalContent.style.display = "block";
    changeAccessRights(document.querySelectorAll(".AccessRightsSwitch"), "opt1");
    document.querySelector("#btn-addUserCancel").addEventListener("click", function (e) {
      e.preventDefault();
      containerOverlay.style.display = "none";
      AddUserModalContent.style.display = "none";
    });
    document.querySelector("#btn-addUserAcept").addEventListener("click", function (e) {
      e.preventDefault();
      _addUser();
    });
  }

  var sel = document.querySelector("select");

  $(".AccessRightsSwitch").change(function () {
    if ($(this).is(":checked")) {
      if (RunMode === "DEBUG") console.log("Is checked");
    } else {
      if (RunMode === "DEBUG") console.log("Is Not checked");
    }
  });

  sel.addEventListener("change", function (e) {
    var opt = e.target[e.target.selectedIndex].value;
    var AccessSwitch = document.querySelectorAll(".AccessRightsSwitch");
    changeAccessRights(AccessSwitch, opt);
  });

  var _getUserRole = function _getUserRole() {
    return sel.options[sel.selectedIndex].text;
  };

  var _getChanges = function _getChanges() {
    var AccessSwitch = document.querySelectorAll(".AccessRightsSwitch");
    var accessString = _getAccessString(AccessSwitch);
    var userRole = _getUserRole();
    var queryString = {};
    if (RunMode === "DEBUG") console.log(oldData);
    for (var prop in oldData) {
      if (hasOwnProperty.call(oldData, prop)) {
        console.log(prop);
        if (prop === "Role") {
          if (oldData[prop].toUpperCase() !== userRole.toUpperCase()) {
            queryString.Role = userRole;
            console.warn(oldData[prop], userRole);
          } else {
            console.log(oldData[prop], userRole);
          }
        } else {
          if (prop === "AccessString") {
            if (oldData[prop] !== accessString) {
              console.warn(oldData[prop], accessString);
              queryString.AccessString = accessString;
            } else {
              console.log(oldData[prop], accessString);
            }
          } else {
            if (prop === 'ExpirateDate') {
              if (oldData[prop] === null) oldData[prop] = '';
              if (oldData[prop] !== document.getElementById(prop).value) {
                queryString.ExpirateDate = document.getElementById(prop).value;
                console.warn(oldData[prop], document.getElementById(prop).value);
              } else {
                console.log(oldData[prop], document.getElementById(prop).value);
              }
            } else {
              if (oldData[prop].toUpperCase() !== document.getElementById(prop).value.toUpperCase()) {
                queryString[prop] = document.getElementById(prop).value;
                console.warn(oldData[prop], document.getElementById(prop).value);
              } else {
                console.log(oldData[prop], document.getElementById(prop).value);
              }
            }
          }
        }
      }
    }
    if (RunMode === 'DEBUG') console.log(queryString);
    return queryString;
  };

  var _updateUser = function _updateUser(oData) {
    var queryString = _getChanges();
    if (queryString) {
      var _data = {
        userName: oData.UserName,
        queryString: queryString
      };
      execFetch("/updateuser", "POST", _data).then(function (d) {
        if (RunMode === "DEBUG") console.log(d);
        showToast("Datos usuario " + _data.userName + " actualizados.", "success");
        document.getElementById("refresh").click();
      }).catch(function (e) {
        showToast("Error al grabar los cambios para el usuario " + _data.userName + ".<br>Err:" + e, "err");
        if (RunMode === "DEBUG") console.log(e);
      });
    }
  };

  var _getAccessString = function _getAccessString(AccessSwitch) {
    var result = "";
    var v = 0;

    for (var x = 0; x < AccessSwitch.length; x++) {
      if (AccessSwitch[x].checked) {
        v = 1;
      } else {
        v = 0;
      }
      if (x != 0) {
        result += "," + v;
      } else {
        result += v;
      }
    }
    return result;
  };

  var _addUser = function _addUser() {
    var AccessSwitch = document.querySelectorAll(".AccessRightsSwitch");
    var userName = document.querySelector("#UserName").value;
    var companyName = document.querySelector("#CompanyName").value;
    var userPassword = document.querySelector("#UserPasswd").value;
    var userRole = sel[sel.selectedIndex].innerHTML;
    var userRootPath = document.querySelector("#RootPath").value;
    var expirateDate = document.querySelector("#ExpirateDate").value;
    var result = _getAccessString(AccessSwitch);

    if (RunMode === "DEBUG") console.log("User Name: " + userName);
    if (RunMode === "DEBUG") console.log("Company Name: " + companyName);
    if (RunMode === "DEBUG") console.log("Password: " + userPassword);
    if (RunMode === "DEBUG") console.log("Root Path: " + userRootPath);
    if (RunMode === "DEBUG") console.log("Expirate Date: " + expirateDate);
    if (RunMode === "DEBUG") console.log("Role: " + userRole);
    if (RunMode === "DEBUG") console.log("Access Rights: " + result);
    var data = {
      userName: userName,
      userPassword: Base64.encode(md5(userPassword)),
      companyName: companyName,
      userRole: userRole,
      expirateDate: expirateDate,
      rootPath: userRootPath,
      accessRights: result
    };
    execFetch("/adduser", "POST", data).then(function (d) {
      if (RunMode === "DEBUG") console.log(d);
      showToast("Usuario " + data.userName + " añadido.", "success");
      document.getElementById("refresh").click();
      document.querySelector("#formAddUser").reset();
      changeAccessRights(document.querySelectorAll(".AccessRightsSwitch"), "opt1");
    }).catch(function (e) {
      showToast("Error al añadir usuario " + data.userName + ".<br>Err:" + e, "err");
      if (RunMode === "DEBUG") console.log(e);
    });
  };
};

////////////////////////////////////
// End user manage module
///////////////////////////////////

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9tb2R1bGVzL3VzZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0FDQ0U7QUFDQTtBQUNBOztBQUVBLElBQU0saUJBQWlCLFNBQWpCLGNBQWlCLFdBQVk7QUFDakMsTUFBSSxZQUFZLE9BQWhCLEVBQXlCLFFBQVEsR0FBUixDQUFZLFFBQVo7O0FBRXpCLFlBQVUsMEJBQTBCLFFBQXBDLEVBQThDLEtBQTlDLEVBQXFELElBQXJELEVBQ0csSUFESCxDQUNRLGFBQUs7QUFDVCxRQUFJLFlBQVksT0FBaEIsRUFBeUIsUUFBUSxHQUFSLENBQVksQ0FBWjtBQUN6QixRQUFJLEVBQUUsTUFBRixJQUFZLElBQWhCLEVBQXNCO0FBQ3BCLHNCQUFnQixXQUFoQixFQUE2QixFQUFFLElBQS9CO0FBQ0QsS0FGRCxNQUVPO0FBQ0wsZ0JBQVUsRUFBRSxPQUFaLEVBQXFCLEtBQXJCO0FBQ0Q7QUFDRixHQVJILEVBU0csS0FUSCxDQVNTLGFBQUs7QUFDVixjQUNFLDZCQUE2QixRQUE3QixHQUF3QyxXQUF4QyxHQUFzRCxDQUR4RCxFQUVFLEtBRkY7QUFJQSxRQUFJLFlBQVksT0FBaEIsRUFBeUIsUUFBUSxHQUFSLENBQVksQ0FBWjtBQUMxQixHQWZIO0FBZ0JELENBbkJEOztBQXNCQSxJQUFNLGdCQUFnQixTQUFoQixhQUFnQixDQUFDLEVBQUQsRUFBUTtBQUM1QixZQUFVLFFBQVYsRUFBb0IsS0FBcEIsRUFDRyxJQURILENBQ1EsYUFBSztBQUNULFFBQUksWUFBWSxPQUFoQixFQUF5QixRQUFRLEdBQVIsQ0FBWSxDQUFaO0FBQ3pCLFFBQUksUUFBUSxFQUFFLElBQWQ7QUFDQSxRQUFJLFVBQVUsRUFBZDtBQUNBLFNBQUssSUFBSSxJQUFJLENBQWIsRUFBZ0IsSUFBSSxNQUFNLE1BQTFCLEVBQWtDLEdBQWxDLEVBQXVDO0FBQ3JDLG1DQUEwQixNQUFNLENBQU4sRUFBUyxNQUFu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LGFBQUs7QUFDVixnQkFDRSw2QkFBNkIsS0FBSyxRQUFsQyxHQUE2QyxXQUE3QyxHQUEyRCxDQUQ3RCxFQUVFLEtBRkY7QUFJQSxVQUFJLFlBQVksT0FBaEIsRUFBeUIsUUFBUSxHQUFSLENBQVksQ0FBWjtBQUMxQixLQWpCSDtBQWtCRCxHQTVDRDtBQTZDRCxDQTNPRDs7QUE2T0Y7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAvLyBVc2VycyBtYW5hZ2UgbW9kdWxlXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgY29uc3Qgc2VhcmNoVXNlck5hbWUgPSB1c2VyTmFtZSA9PiB7XG4gICAgaWYgKFJ1bk1vZGUgPT09IFwiREVCVUdcIikgY29uc29sZS5sb2codXNlck5hbWUpO1xuXG4gICAgZXhlY0ZldGNoKFwiL3NlYXJjaHVzZXI/dXNlck5hbWU9XCIgKyB1c2VyTmFtZSwgXCJHRVRcIiwgbnVsbClcbiAgICAgIC50aGVuKGQgPT4ge1xuICAgICAgICBpZiAoUnVuTW9kZSA9PT0gXCJERUJVR1wiKSBjb25zb2xlLmxvZyhkKTtcbiAgICAgICAgaWYgKGQuc3RhdHVzID09IFwiT0tcIikge1xuICAgICAgICAgIHNob3dBZGRVc2VyRm9ybShcIkVkaXQgVXNlclwiLCBkLmRhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNob3dUb2FzdChkLm1lc3NhZ2UsIFwiZXJyXCIpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGUgPT4ge1xuICAgICAgICBzaG93VG9hc3QoXG4gICAgICAgICAgXCJFcnJvciBhbCBidXNjYXIgdXN1YXJpbyBcIiArIHVzZXJOYW1lICsgXCIuPGJyPkVycjpcIiArIGUsXG4gICAgICAgICAgXCJlcnJcIlxuICAgICAgICApO1xuICAgICAgICBpZiAoUnVuTW9kZSA9PT0gXCJERUJVR1wiKSBjb25zb2xlLmxvZyhlKTtcbiAgICAgIH0pO1xuICB9O1xuXG5cbiAgY29uc3QgTG9hZFVzZXJzTGlzdCA9IChlbCkgPT4ge1xuICAgIGV4ZWNGZXRjaChcIi91c2Vyc1wiLCBcIkdFVFwiKVxuICAgICAgLnRoZW4oZCA9PiB7XG4gICAgICAgIGlmIChSdW5Nb2RlID09PSBcIkRFQlVHXCIpIGNvbnNvbGUubG9nKGQpO1xuICAgICAgICBsZXQgdXNlcnMgPSBkLmRhdGE7XG4gICAgICAgIGxldCBvcHRpb25zID0gJyc7XG4gICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdXNlcnMubGVuZ3RoOyB4KyspIHtcbiAgICAgICAgICBvcHRpb25zICs9IGA8b3B0aW9uIGlkPVwiJHt1c2Vyc1t4XS5Vc2VySWR9XCI+JHt1c2Vyc1t4XS5Vc2VyTmFtZX08L29wdGlvbj5gO1xuICAgICAgICB9XG4gICAgICAgIGVsLmlubmVySFRNTCA9IG9wdGlvbnM7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGUgPT4ge1xuICAgICAgICBzaG93VG9hc3QoXCJFcnJvciBhbCBncmFiYXIgbG9zIGNhbWJpb3MgcGFyYSBlbCB1c3VhcmlvIFwiICsgZGF0YS51c2VyTmFtZSArIFwiLjxicj5FcnI6XCIgKyBlLCBcImVyclwiKTtcbiAgICAgICAgaWYgKFJ1bk1vZGUgPT09IFwiREVCVUdcIikgY29uc29sZS5sb2coZSk7XG4gICAgICB9KTtcbiAgfTtcblxuICBjb25zdCBlZGl0VXNlciA9ICgpID0+IHtcbiAgICBsZXQgQWRkVXNlck1vZGFsQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjQWRkVXNlck1vZGFsQ29udGVudFwiKTtcbiAgICBsZXQgU2VhcmNoVXNlck1vZGFsQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIiNzZWFyY2hVc2VyTW9kYWxDb250ZW50XCJcbiAgICApO1xuXG5cbiAgICBsZXQgY29udGFpbmVyT3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29udGFpbmVyLW92ZXJsYXlcIik7XG4gICAgQWRkVXNlck1vZGFsQ29udGVudC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgU2VhcmNoVXNlck1vZGFsQ29udGVudC5pbm5lckhUTUwgPSBodG1sU2VhcmNoVXNlclRlbXBsYXRlO1xuICAgIExvYWRVc2Vyc0xpc3QoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJzTGlzdCcpKTtcbiAgICBTZWFyY2hVc2VyTW9kYWxDb250ZW50LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgY29udGFpbmVyT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgIFNlYXJjaFVzZXJNb2RhbENvbnRlbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGUgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgICAgc2VhcmNoVXNlck5hbWUoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzZWFyY2hVc2VyTmFtZVwiKS52YWx1ZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNidG5TZWFyY2hVc2VyXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHNlYXJjaFVzZXJOYW1lKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2VhcmNoVXNlck5hbWVcIikudmFsdWUpO1xuICAgIH0pO1xuICAgIGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3RvcihcIiNidG4tU2VhcmNoVXNlckNhbmNlbFwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBTZWFyY2hVc2VyTW9kYWxDb250ZW50LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgY29udGFpbmVyT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICB9KTtcbiAgfTtcblxuXG4gIGNvbnN0IHNlbGVjdFJvbGUgPSAoZWxlbWVudCwgcm9sZSkgPT4ge1xuICAgIGlmIChSdW5Nb2RlID09PSBcIkRFQlVHXCIpIGNvbnNvbGUubG9nKHJvbGUpO1xuICAgIGZvciAobGV0IHggPSAwOyB4IDwgZWxlbWVudC5vcHRpb25zLmxlbmd0aDsgeCsrKSB7XG4gICAgICBpZiAoUnVuTW9kZSA9PT0gXCJERUJVR1wiKSBjb25zb2xlLmxvZyhcIm9wdGlvbjogXCIsIGVsZW1lbnQub3B0aW9uc1t4XS50ZXh0KTtcbiAgICAgIGlmIChlbGVtZW50Lm9wdGlvbnNbeF0udGV4dC50b1VwcGVyQ2FzZSgpID09PSByb2xlLnRvVXBwZXJDYXNlKCkpIHtcbiAgICAgICAgZWxlbWVudC5vcHRpb25zW3hdLnNlbGVjdGVkID0gXCJzZWxlY3RlZFwiO1xuICAgICAgICBlbGVtZW50LnNlbGVjdGVkSW5kZXggPSB4O1xuICAgICAgICBpZiAoUnVuTW9kZSA9PT0gXCJERUJVR1wiKVxuICAgICAgICAgIGNvbnNvbGUubG9nKFwib3B0aW9uIHNlbGVjdGVkOiBcIiwgZWxlbWVudC5vcHRpb25zW3hdLnRleHQpO1xuICAgICAgICBpZiAocm9sZS50b1VwcGVyQ2FzZSgpICE9PSBcIkNVU1RPTVwiKSB7XG4gICAgICAgICAgY2hhbmdlQWNjZXNzUmlnaHRzKFxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5BY2Nlc3NSaWdodHNTd2l0Y2hcIiksXG4gICAgICAgICAgICBlbGVtZW50Lm9wdGlvbnNbeF0udmFsdWVcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCBzaG93QWRkVXNlckZvcm0gPSAodGl0bGUsIGRhdGEpID0+IHtcbiAgICBsZXQgQWRkVXNlck1vZGFsQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjQWRkVXNlck1vZGFsQ29udGVudFwiKTtcbiAgICBsZXQgY29udGFpbmVyT3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29udGFpbmVyLW92ZXJsYXlcIik7XG4gICAgbGV0IFNlYXJjaFVzZXJNb2RhbENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIjc2VhcmNoVXNlck1vZGFsQ29udGVudFwiXG4gICAgKTtcbiAgICBsZXQgbW9kZSA9IGRhdGEgPyBcImVkaXRcIiA6IFwiYWRkXCI7XG4gICAgbGV0IG9sZERhdGEgPSBudWxsO1xuICAgIFNlYXJjaFVzZXJNb2RhbENvbnRlbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgQWRkVXNlck1vZGFsQ29udGVudC5pbm5lckhUTUwgPSBodG1sVXNlckZvcm1UZW1wbGF0ZTtcbiAgICBpZiAoZGF0YSkge1xuICAgICAgaWYgKFJ1bk1vZGUgPT09IFwiREVCVUdcIikgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICBvbGREYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZGF0YSk7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3VzZXJGb3JtVGl0bGVcIikuaW5uZXJIVE1MID0gdGl0bGU7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI1VzZXJOYW1lXCIpLnZhbHVlID0gZGF0YS5Vc2VyTmFtZTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjQ29tcGFueU5hbWVcIikudmFsdWUgPSBkYXRhLkNvbXBhbnlOYW1lO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNVc2VyUGFzc3dkXCIpLnZhbHVlID0gZGF0YS5Vc2VyUGFzc3dkO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyZXBlYXRVc2VyUGFzc3dkXCIpLnZhbHVlID0gZGF0YS5Vc2VyUGFzc3dkO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNSb290UGF0aFwiKS52YWx1ZSA9IGRhdGEuUm9vdFBhdGg7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI0V4cGlyYXRlRGF0ZVwiKS52YWx1ZSA9IGRhdGEuRXhwaXJhdGVEYXRlO1xuICAgICAgLy9kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2V4cGlyYXRpb25EYXRlXCIpXG4gICAgICBzZWxlY3RSb2xlKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjUm9sZU9wdGlvbnNcIiksIGRhdGEuUm9sZSk7XG4gICAgICBpZiAoZGF0YS5Sb2xlLnRvVXBwZXJDYXNlKCkgPT09IFwiQ1VTVE9NXCIpXG4gICAgICAgIGNoZWNrQWNjZXNzUmlnaHRzKGRhdGEuQWNjZXNzU3RyaW5nKTtcbiAgICAgIGNvbnRhaW5lck92ZXJsYXkuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgIEFkZFVzZXJNb2RhbENvbnRlbnQuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJsYWJlbFtmb3I9VXNlck5hbWVdXCIpLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibGFiZWxbZm9yPUNvbXBhbnlOYW1lXVwiKS5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImxhYmVsW2Zvcj1Vc2VyUGFzc3dkXVwiKS5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuICAgICAgZG9jdW1lbnRcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCJsYWJlbFtmb3I9cmVwZWF0VXNlclBhc3N3ZF1cIilcbiAgICAgICAgLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibGFiZWxbZm9yPVJvb3RQYXRoXVwiKS5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNVc2VyTmFtZVwiKS5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICAgIGRvY3VtZW50XG4gICAgICAgIC5xdWVyeVNlbGVjdG9yKFwiI2J0bi1hZGRVc2VyQ2FuY2VsXCIpXG4gICAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIC8vY29udGFpbmVyT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgQWRkVXNlck1vZGFsQ29udGVudC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgU2VhcmNoVXNlck1vZGFsQ29udGVudC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICB9KTtcbiAgICAgIGRvY3VtZW50XG4gICAgICAgIC5xdWVyeVNlbGVjdG9yKFwiI2J0bi1hZGRVc2VyQWNlcHRcIilcbiAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgX3VwZGF0ZVVzZXIob2xkRGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250YWluZXJPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICBBZGRVc2VyTW9kYWxDb250ZW50LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICBjaGFuZ2VBY2Nlc3NSaWdodHMoXG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuQWNjZXNzUmlnaHRzU3dpdGNoXCIpLFxuICAgICAgICBcIm9wdDFcIlxuICAgICAgKTtcbiAgICAgIGRvY3VtZW50XG4gICAgICAgIC5xdWVyeVNlbGVjdG9yKFwiI2J0bi1hZGRVc2VyQ2FuY2VsXCIpXG4gICAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGNvbnRhaW5lck92ZXJsYXkuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgIEFkZFVzZXJNb2RhbENvbnRlbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9KTtcbiAgICAgIGRvY3VtZW50XG4gICAgICAgIC5xdWVyeVNlbGVjdG9yKFwiI2J0bi1hZGRVc2VyQWNlcHRcIilcbiAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgX2FkZFVzZXIoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbGV0IHNlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJzZWxlY3RcIik7XG5cbiAgICAkKFwiLkFjY2Vzc1JpZ2h0c1N3aXRjaFwiKS5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCQodGhpcykuaXMoXCI6Y2hlY2tlZFwiKSkge1xuICAgICAgICBpZiAoUnVuTW9kZSA9PT0gXCJERUJVR1wiKSBjb25zb2xlLmxvZyhcIklzIGNoZWNrZWRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoUnVuTW9kZSA9PT0gXCJERUJVR1wiKSBjb25zb2xlLmxvZyhcIklzIE5vdCBjaGVja2VkXCIpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc2VsLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZSA9PiB7XG4gICAgICBsZXQgb3B0ID0gZS50YXJnZXRbZS50YXJnZXQuc2VsZWN0ZWRJbmRleF0udmFsdWU7XG4gICAgICBsZXQgQWNjZXNzU3dpdGNoID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5BY2Nlc3NSaWdodHNTd2l0Y2hcIik7XG4gICAgICBjaGFuZ2VBY2Nlc3NSaWdodHMoQWNjZXNzU3dpdGNoLCBvcHQpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgX2dldFVzZXJSb2xlID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIHNlbC5vcHRpb25zW3NlbC5zZWxlY3RlZEluZGV4XS50ZXh0O1xuICAgIH07XG5cbiAgICBjb25zdCBfZ2V0Q2hhbmdlcyA9ICgpID0+IHtcbiAgICAgIGxldCBBY2Nlc3NTd2l0Y2ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLkFjY2Vzc1JpZ2h0c1N3aXRjaFwiKTtcbiAgICAgIGxldCBhY2Nlc3NTdHJpbmcgPSBfZ2V0QWNjZXNzU3RyaW5nKEFjY2Vzc1N3aXRjaCk7XG4gICAgICBsZXQgdXNlclJvbGUgPSBfZ2V0VXNlclJvbGUoKTtcbiAgICAgIGxldCBxdWVyeVN0cmluZyA9IHt9O1xuICAgICAgaWYgKFJ1bk1vZGUgPT09IFwiREVCVUdcIikgY29uc29sZS5sb2cob2xkRGF0YSk7XG4gICAgICBmb3IgKGxldCBwcm9wIGluIG9sZERhdGEpIHtcbiAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwob2xkRGF0YSwgcHJvcCkpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhwcm9wKTtcbiAgICAgICAgICBpZiAocHJvcCA9PT0gXCJSb2xlXCIpIHtcbiAgICAgICAgICAgIGlmIChvbGREYXRhW3Byb3BdLnRvVXBwZXJDYXNlKCkgIT09IHVzZXJSb2xlLnRvVXBwZXJDYXNlKCkpIHtcbiAgICAgICAgICAgICAgcXVlcnlTdHJpbmcuUm9sZSA9IHVzZXJSb2xlO1xuICAgICAgICAgICAgICBjb25zb2xlLndhcm4ob2xkRGF0YVtwcm9wXSwgdXNlclJvbGUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2cob2xkRGF0YVtwcm9wXSwgdXNlclJvbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gXCJBY2Nlc3NTdHJpbmdcIikge1xuICAgICAgICAgICAgICBpZiAob2xkRGF0YVtwcm9wXSAhPT0gYWNjZXNzU3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKG9sZERhdGFbcHJvcF0sIGFjY2Vzc1N0cmluZyk7XG4gICAgICAgICAgICAgICAgcXVlcnlTdHJpbmcuQWNjZXNzU3RyaW5nID0gYWNjZXNzU3RyaW5nO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG9sZERhdGFbcHJvcF0sIGFjY2Vzc1N0cmluZyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGlmIChwcm9wID09PSAnRXhwaXJhdGVEYXRlJykge1xuICAgICAgICAgICAgICAgIGlmIChvbGREYXRhW3Byb3BdID09PSBudWxsKSBvbGREYXRhW3Byb3BdID0gJyc7XG4gICAgICAgICAgICAgICAgaWYgKG9sZERhdGFbcHJvcF0gIT09IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHByb3ApLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICBxdWVyeVN0cmluZy5FeHBpcmF0ZURhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwcm9wKS52YWx1ZVxuICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKG9sZERhdGFbcHJvcF0sIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHByb3ApLnZhbHVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cob2xkRGF0YVtwcm9wXSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocHJvcCkudmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChvbGREYXRhW3Byb3BdLnRvVXBwZXJDYXNlKCkgIT09IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHByb3ApLnZhbHVlLnRvVXBwZXJDYXNlKCkpIHtcbiAgICAgICAgICAgICAgICAgIHF1ZXJ5U3RyaW5nW3Byb3BdID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocHJvcCkudmFsdWU7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4ob2xkRGF0YVtwcm9wXSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocHJvcCkudmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhvbGREYXRhW3Byb3BdLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwcm9wKS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoUnVuTW9kZSA9PT0gJ0RFQlVHJykgY29uc29sZS5sb2cocXVlcnlTdHJpbmcpO1xuICAgICAgcmV0dXJuIHF1ZXJ5U3RyaW5nO1xuICAgIH07XG5cbiAgICBjb25zdCBfdXBkYXRlVXNlciA9IChvRGF0YSkgPT4ge1xuICAgICAgbGV0IHF1ZXJ5U3RyaW5nID0gX2dldENoYW5nZXMoKTtcbiAgICAgIGlmIChxdWVyeVN0cmluZykge1xuICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICB1c2VyTmFtZTogb0RhdGEuVXNlck5hbWUsXG4gICAgICAgICAgcXVlcnlTdHJpbmc6IHF1ZXJ5U3RyaW5nXG4gICAgICAgIH07XG4gICAgICAgIGV4ZWNGZXRjaChcIi91cGRhdGV1c2VyXCIsIFwiUE9TVFwiLCBkYXRhKVxuICAgICAgICAgIC50aGVuKGQgPT4ge1xuICAgICAgICAgICAgaWYgKFJ1bk1vZGUgPT09IFwiREVCVUdcIikgY29uc29sZS5sb2coZCk7XG4gICAgICAgICAgICBzaG93VG9hc3QoXG4gICAgICAgICAgICAgIFwiRGF0b3MgdXN1YXJpbyBcIiArIGRhdGEudXNlck5hbWUgKyBcIiBhY3R1YWxpemFkb3MuXCIsXG4gICAgICAgICAgICAgIFwic3VjY2Vzc1wiXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZWZyZXNoXCIpLmNsaWNrKCk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgICBzaG93VG9hc3QoXG4gICAgICAgICAgICAgIFwiRXJyb3IgYWwgZ3JhYmFyIGxvcyBjYW1iaW9zIHBhcmEgZWwgdXN1YXJpbyBcIiArXG4gICAgICAgICAgICAgIGRhdGEudXNlck5hbWUgK1xuICAgICAgICAgICAgICBcIi48YnI+RXJyOlwiICtcbiAgICAgICAgICAgICAgZSxcbiAgICAgICAgICAgICAgXCJlcnJcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChSdW5Nb2RlID09PSBcIkRFQlVHXCIpIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCBfZ2V0QWNjZXNzU3RyaW5nID0gQWNjZXNzU3dpdGNoID0+IHtcbiAgICAgIGxldCByZXN1bHQgPSBcIlwiO1xuICAgICAgbGV0IHYgPSAwO1xuXG4gICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IEFjY2Vzc1N3aXRjaC5sZW5ndGg7IHgrKykge1xuICAgICAgICBpZiAoQWNjZXNzU3dpdGNoW3hdLmNoZWNrZWQpIHtcbiAgICAgICAgICB2ID0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoeCAhPSAwKSB7XG4gICAgICAgICAgcmVzdWx0ICs9IFwiLFwiICsgdjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXN1bHQgKz0gdjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgY29uc3QgX2FkZFVzZXIgPSAoKSA9PiB7XG4gICAgICBsZXQgQWNjZXNzU3dpdGNoID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5BY2Nlc3NSaWdodHNTd2l0Y2hcIik7XG4gICAgICBsZXQgdXNlck5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI1VzZXJOYW1lXCIpLnZhbHVlO1xuICAgICAgbGV0IGNvbXBhbnlOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNDb21wYW55TmFtZVwiKS52YWx1ZTtcbiAgICAgIGxldCB1c2VyUGFzc3dvcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI1VzZXJQYXNzd2RcIikudmFsdWU7XG4gICAgICBsZXQgdXNlclJvbGUgPSBzZWxbc2VsLnNlbGVjdGVkSW5kZXhdLmlubmVySFRNTDtcbiAgICAgIGxldCB1c2VyUm9vdFBhdGggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI1Jvb3RQYXRoXCIpLnZhbHVlO1xuICAgICAgbGV0IGV4cGlyYXRlRGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjRXhwaXJhdGVEYXRlXCIpLnZhbHVlO1xuICAgICAgbGV0IHJlc3VsdCA9IF9nZXRBY2Nlc3NTdHJpbmcoQWNjZXNzU3dpdGNoKTtcblxuICAgICAgaWYgKFJ1bk1vZGUgPT09IFwiREVCVUdcIikgY29uc29sZS5sb2coXCJVc2VyIE5hbWU6IFwiICsgdXNlck5hbWUpO1xuICAgICAgaWYgKFJ1bk1vZGUgPT09IFwiREVCVUdcIikgY29uc29sZS5sb2coXCJDb21wYW55IE5hbWU6IFwiICsgY29tcGFueU5hbWUpO1xuICAgICAgaWYgKFJ1bk1vZGUgPT09IFwiREVCVUdcIikgY29uc29sZS5sb2coXCJQYXNzd29yZDogXCIgKyB1c2VyUGFzc3dvcmQpO1xuICAgICAgaWYgKFJ1bk1vZGUgPT09IFwiREVCVUdcIikgY29uc29sZS5sb2coXCJSb290IFBhdGg6IFwiICsgdXNlclJvb3RQYXRoKTtcbiAgICAgIGlmIChSdW5Nb2RlID09PSBcIkRFQlVHXCIpIGNvbnNvbGUubG9nKFwiRXhwaXJhdGUgRGF0ZTogXCIgKyBleHBpcmF0ZURhdGUpO1xuICAgICAgaWYgKFJ1bk1vZGUgPT09IFwiREVCVUdcIikgY29uc29sZS5sb2coXCJSb2xlOiBcIiArIHVzZXJSb2xlKTtcbiAgICAgIGlmIChSdW5Nb2RlID09PSBcIkRFQlVHXCIpIGNvbnNvbGUubG9nKFwiQWNjZXNzIFJpZ2h0czogXCIgKyByZXN1bHQpO1xuICAgICAgbGV0IGRhdGEgPSB7XG4gICAgICAgIHVzZXJOYW1lOiB1c2VyTmFtZSxcbiAgICAgICAgdXNlclBhc3N3b3JkOiBCYXNlNjQuZW5jb2RlKG1kNSh1c2VyUGFzc3dvcmQpKSxcbiAgICAgICAgY29tcGFueU5hbWU6IGNvbXBhbnlOYW1lLFxuICAgICAgICB1c2VyUm9sZTogdXNlclJvbGUsXG4gICAgICAgIGV4cGlyYXRlRGF0ZTogZXhwaXJhdGVEYXRlLFxuICAgICAgICByb290UGF0aDogdXNlclJvb3RQYXRoLFxuICAgICAgICBhY2Nlc3NSaWdodHM6IHJlc3VsdFxuICAgICAgfTtcbiAgICAgIGV4ZWNGZXRjaChcIi9hZGR1c2VyXCIsIFwiUE9TVFwiLCBkYXRhKVxuICAgICAgICAudGhlbihkID0+IHtcbiAgICAgICAgICBpZiAoUnVuTW9kZSA9PT0gXCJERUJVR1wiKSBjb25zb2xlLmxvZyhkKTtcbiAgICAgICAgICBzaG93VG9hc3QoXCJVc3VhcmlvIFwiICsgZGF0YS51c2VyTmFtZSArIFwiIGHDsWFkaWRvLlwiLCBcInN1Y2Nlc3NcIik7XG4gICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZWZyZXNoXCIpLmNsaWNrKCk7XG4gICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNmb3JtQWRkVXNlclwiKS5yZXNldCgpO1xuICAgICAgICAgIGNoYW5nZUFjY2Vzc1JpZ2h0cyhcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuQWNjZXNzUmlnaHRzU3dpdGNoXCIpLFxuICAgICAgICAgICAgXCJvcHQxXCJcbiAgICAgICAgICApO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgc2hvd1RvYXN0KFxuICAgICAgICAgICAgXCJFcnJvciBhbCBhw7FhZGlyIHVzdWFyaW8gXCIgKyBkYXRhLnVzZXJOYW1lICsgXCIuPGJyPkVycjpcIiArIGUsXG4gICAgICAgICAgICBcImVyclwiXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoUnVuTW9kZSA9PT0gXCJERUJVR1wiKSBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgfTtcblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBFbmQgdXNlciBtYW5hZ2UgbW9kdWxlXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiJdfQ==
